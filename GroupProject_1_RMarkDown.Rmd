---
title: "GroupProject_1_RMarkDown"
author: "Anyu"
date: "2021/3/19"
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

## R Markdown

This is an R Markdown document. Markdown is a simple formatting syntax for authoring HTML, PDF, and MS Word documents. For more details on using R Markdown see <http://rmarkdown.rstudio.com>.

When you click the **Knit** button a document will be generated that includes both content as well as the output of any embedded R code chunks within the document. You can embed an R code chunk like this:

```{r cars}
summary(cars)
```

## Including Plots

You can also embed plots, for example:

```{r pressure, echo=FALSE}
plot(pressure)
```

Note that the `echo = FALSE` parameter was added to the code chunk to prevent printing of the R code that generated the plot.

HI

What is going on

Hello



## TO 628 Group Project 1: Prosper

### Data Exploration and Cleansing 

First, we import the dataset and see its structure.
```{r}
#Import data
listings <- read.csv("ProjectA_Listings2013.csv")
str(listings)
summary(listings)
```
Then, we convert applicable variables into factors to develop a linear regression model.

```{r}
#convert applicable variables into factors
listings$loan_status <- as.factor(listings$loan_status)
listings$loan_status <- factor(listings$loan_status, labels = c("CURRENT", "CHARGEOFF", "DEFAULTED", "COMPLETED"))
listings$prosper_rating <- as.factor(listings$prosper_rating)
listings$scorex <- as.factor(listings$scorex)
listings$prosper_score <- as.factor(listings$prosper_score)
listings$listing_category_id <- as.factor(listings$listing_category_id)
listings$income_range <- as.factor(listings$income_range)
listings$income_range <- factor(listings$income_range, labels = c("$0", "$1-24,999", "$25,000-49,999", "$50,000-74,999", "$75,000-99,999", "$100,000+", "Not employed"))
listings$employment_status_description <- as.factor(listings$employment_status_description)
listings$occupation <- as.factor(listings$occupation)
listings$lender_indicator <- as.factor(listings$lender_indicator)
```
We also delete unnecessary columns.

```{r}
#Delete irrelevant variables
listings$loan_status_description <- NULL
listings$loan_origination_date <- NULL
listings$income_range_description <- NULL
listings$borrower_state <- NULL #Assuming borrower states do not affect interest rates
listings$borrower_city <- NULL #Assuming borrower cities do not affect interest rates
listings$first_recorded_credit_line <- NULL #Assuming this date does not affect interest rates
summary(listings)
```

```{r}
#Set negative values in months_employed to NA
listings$months_employed <- ifelse(listings$months_employed < 0, NA, listings$months_employed)
```


### Linear Regression Model


```{r}
#Develop a linear regression model
model1 <- lm(borrower_rate ~ ., data = listings)
summary(model1)
```

```{r}
#Remove insignificant variables
model2 <- lm(borrower_rate ~ number_of_days + principal_balance + loan_status + amount_funded + prosper_rating + listing_term + listing_monthly_payment + scorex + stated_monthly_income + employment_status_description + occupation + lender_indicator + monthly_debt + inquiries_last6_months + open_credit_lines + bankcard_utilization + delinquencies_over30_days, data = listings)
summary(model2)
```

#Remove ex post (items determined after loan funding) variables
```{r}
model3 <- lm(borrower_rate ~ loan_status + amount_funded + prosper_rating + listing_term + listing_monthly_payment + scorex + stated_monthly_income + employment_status_description + occupation + lender_indicator + monthly_debt + inquiries_last6_months + open_credit_lines + bankcard_utilization + delinquencies_over30_days, data = listings)
summary(model3)
```

#Anyu Model
```{r}
model4 <- lm(borrower_rate ~ 
                  amount_funded
                + prosper_rating
                + listing_term
                + listing_monthly_payment
                + scorex
                + prosper_score
                + income_verifiable
                + dti_wprosper_loan
                + lender_indicator
                + monthly_debt
                + current_delinquencies
                + public_records_last12_months
                + inquiries_last6_months
                + amount_delinquent
                + current_credit_lines
                + open_credit_lines
                + bankcard_utilization
                + total_open_revolving_accounts
                + real_estate_balance
                + total_inquiries
                + satisfactory_accounts
                + was_delinquent_derog
                + delinquencies_over30_days
                + delinquencies_over90_days
                + is_homeowner
                , data = listings)

```






#Modify dataset for Logistic Regression
```{r}
#set up new data frame
listings2 <- listings
listings2$loan_status <- ifelse(listings2$loan_status == "DEFAULTED", 1,0)
```

#Run Logistic Regression Model
```{r}
logisticmodel1 <- glm(loan_status~., data = listings2, family = "binomial")
summary(logisticmodel1)
```

##Update Logistic Model
```{r}
logisticmodel2 = glm(loan_status ~ number_of_days + principal_balance + prosper_rating + borrower_rate + listing_term + bankcard_utilization + total_inquiries, data = listings2, family = "binomial")
summary(logisticmodel2)
```
